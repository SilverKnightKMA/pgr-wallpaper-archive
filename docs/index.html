<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PGR Wallpaper Archive</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        :root {
            --bg: #0d1117;
            --card-bg: #161b22;
            --border: #30363d;
            --text: #e6edf3;
            --text-muted: #8b949e;
            --accent: #58a6ff;
            --success: #3fb950;
            --danger: #f85149;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1 { margin-bottom: 8px; }
        .subtitle { color: var(--text-muted); margin-bottom: 24px; }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .filter-group {
            position: relative;
        }
        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 4px;
            display: block;
        }
        .dropdown-toggle {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 14px;
            color: var(--text);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }
        .dropdown-toggle:hover {
            border-color: var(--accent);
        }
        .dropdown-toggle::after {
            content: '‚ñº';
            font-size: 10px;
            color: var(--text-muted);
        }
        .dropdown-toggle.open::after {
            content: '‚ñ≤';
        }
        .dropdown-menu {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .dropdown-menu.show {
            display: block;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 6px 4px;
            cursor: pointer;
            border-radius: 4px;
        }
        .checkbox-item:hover {
            background: var(--border);
        }
        .checkbox-item input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
        }
        .checkbox-item label {
            font-size: 13px;
            cursor: pointer;
            user-select: none;
            flex: 1;
        }
        .controls select, .controls input {
            background: var(--card-bg); color: var(--text);
            border: 1px solid var(--border); border-radius: 6px;
            padding: 8px 12px; font-size: 14px;
            width: 100%;
        }
        .search-group { grid-column: 1 / -1; }
        .stats {
            background: var(--card-bg); border: 1px solid var(--border);
            border-radius: 6px; padding: 16px; margin-bottom: 24px;
            display: flex; gap: 24px; flex-wrap: wrap;
        }
        .stat-item { text-align: center; min-width: 80px; }
        .stat-value { font-size: 24px; font-weight: bold; }
        .stat-label { color: var(--text-muted); font-size: 12px; }
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            align-items: start;
        }
        .card {
            background: var(--card-bg); border: 1px solid var(--border);
            border-radius: 8px; overflow: hidden; transition: border-color 0.2s;
        }
        .card:hover { border-color: var(--accent); }
        .card img {
            width: 100%; aspect-ratio: 16/9; object-fit: cover;
            background: #21262d; display: block;
        }
        .card.card-portrait img {
            aspect-ratio: 9/16;
            object-fit: cover;
        }
        .card-body { padding: 12px; }
        .card-filename {
            font-size: 12px; word-break: break-all;
            color: var(--text-muted); margin-bottom: 8px;
        }
        .card-actions { display: flex; gap: 8px; }
        .card-actions a {
            font-size: 12px; padding: 4px 10px;
            border-radius: 4px; text-decoration: none;
            border: 1px solid var(--border); color: var(--text);
            transition: background 0.2s;
        }
        .card-actions a:hover { background: var(--border); }
        .card-actions a.download { border-color: var(--accent); color: var(--accent); }
        .badge {
            display: inline-block; font-size: 11px; padding: 2px 6px;
            border-radius: 4px; font-weight: 600;
        }
        .badge-success { background: rgba(63,185,80,0.15); color: var(--success); }
        .badge-danger { background: rgba(248,81,73,0.15); color: var(--danger); }
        .loading { text-align: center; padding: 60px; color: var(--text-muted); }
        .empty { text-align: center; padding: 60px; color: var(--text-muted); }
        .timestamp { color: var(--text-muted); font-size: 12px; margin-bottom: 16px; }
        @media (max-width: 600px) {
            .gallery { grid-template-columns: 1fr; }
            .controls { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><img src="favicon.png" alt="PGR" width="32" height="32" style="vertical-align: middle; margin-right: 8px;" onerror="this.src='https://cdnstatic.kurogame.net/h5_manage_dist/pgr_website2.0/favicon.png'">PGR Wallpaper Archive</h1>
        <p class="subtitle">Browse and filter wallpapers from Punishing: Gray Raven</p>

        <div class="controls">
            <div class="filter-group">
                <label class="filter-label">üåê Servers</label>
                <div class="dropdown-toggle" data-dropdown="serverFilter">
                    <span id="serverFilterLabel">All Servers</span>
                </div>
                <div class="dropdown-menu" id="serverFilterMenu"></div>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">üìÇ Categories</label>
                <div class="dropdown-toggle" data-dropdown="categoryFilter">
                    <span id="categoryFilterLabel">All Categories</span>
                </div>
                <div class="dropdown-menu" id="categoryFilterMenu">
                    <div class="checkbox-item">
                        <input type="checkbox" id="cat-desktop" value="desktop" checked>
                        <label for="cat-desktop">üñ•Ô∏è Desktop</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="cat-mobile" value="mobile" checked>
                        <label for="cat-mobile">üì± Mobile</label>
                    </div>
                </div>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">‚úÖ Status</label>
                <div class="dropdown-toggle" data-dropdown="statusFilter">
                    <span id="statusFilterLabel">All Status</span>
                </div>
                <div class="dropdown-menu" id="statusFilterMenu">
                    <div class="checkbox-item">
                        <input type="checkbox" id="status-success" value="success" checked>
                        <label for="status-success">‚úÖ Success</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="status-failed" value="failed" checked>
                        <label for="status-failed">‚ùå Failed</label>
                    </div>
                </div>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">üìÖ Release Time</label>
                <div class="dropdown-toggle" data-dropdown="releaseTimeFilter">
                    <span id="releaseTimeFilterLabel">All Times</span>
                </div>
                <div class="dropdown-menu" id="releaseTimeFilterMenu"></div>
            </div>
            
            <div class="filter-group">
                <label class="filter-label">üîΩ Sort By</label>
                <select id="sortFilter">
                    <option value="startTime-desc">Published Date (Newest)</option>
                    <option value="startTime-asc">Published Date (Oldest)</option>
                    <option value="releaseTime-desc">Downloaded Date (Newest)</option>
                    <option value="releaseTime-asc">Downloaded Date (Oldest)</option>
                    <option value="filename-asc">Filename (A-Z)</option>
                    <option value="filename-desc">Filename (Z-A)</option>
                    <option value="server-asc">Server (A-Z)</option>
                    <option value="server-desc">Server (Z-A)</option>
                    <option value="size-desc">Size (Largest)</option>
                    <option value="size-asc">Size (Smallest)</option>
                </select>
            </div>
            
            <div class="filter-group search-group">
                <label class="filter-label">üîç Search</label>
                <input type="text" id="searchInput" placeholder="Search by filename...">
            </div>
        </div>

        <div class="stats" id="stats">
            <div class="stat-item"><div class="stat-value" id="statTotal">-</div><div class="stat-label">Total</div></div>
            <div class="stat-item"><div class="stat-value" id="statSuccess">-</div><div class="stat-label">Success</div></div>
            <div class="stat-item"><div class="stat-value" id="statFailed">-</div><div class="stat-label">Failed</div></div>
            <div class="stat-item"><div class="stat-value" id="statServers">-</div><div class="stat-label">Servers</div></div>
            <div class="stat-item"><div class="stat-value" id="statTotalSize">-</div><div class="stat-label">Total Size</div></div>
        </div>

        <div class="timestamp" id="lastUpdated"></div>

        <div id="gallery" class="gallery">
            <div class="loading">Loading wallpaper data...</div>
        </div>
    </div>

    <script>
        let REPO = 'SilverKnightKMA/pgr-wallpaper-archive';
        let WALLPAPERS_BRANCH = 'wallpapers';
        let PREVIEW_BRANCH = 'preview';

        let allData = [];
        let serverNames = {};

        // Encode filename for URLs, preserving existing %XX sequences
        function encodeFilename(filename) {
            return filename
                .replace(/[^A-Za-z0-9._~:@!$&'()*+,;=%\/-]/g, c => encodeURIComponent(c))
                .replace(/%(?![0-9A-Fa-f]{2})/g, '%25');
        }

        async function loadConfig() {
            try {
                // Derive repo slug from GitHub Pages hostname if possible
                const host = window.location.hostname;
                const pathParts = window.location.pathname.split('/').filter(Boolean);
                if (host.endsWith('.github.io')) {
                    const owner = host.replace('.github.io', '');
                    const repoName = pathParts[0] || '';
                    if (owner && repoName) {
                        REPO = `${owner}/${repoName}`;
                    }
                }

                const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/config.json`);
                const config = await res.json();
                config.servers.forEach(s => { serverNames[s.id] = s.name; });
                // Read branch names from config
                if (config.wallpapersBranch) WALLPAPERS_BRANCH = config.wallpapersBranch;
                if (config.previewBranch) PREVIEW_BRANCH = config.previewBranch;
            } catch (e) {
                console.warn('Could not load config, using defaults');
            }
        }

        async function loadManifest() {
            const url = `https://raw.githubusercontent.com/${REPO}/main/data/manifest.json`;
            const res = await fetch(url);
            if (!res.ok) throw new Error('Manifest not found');
            return res.json();
        }

        function previewFilename(filename) {
            // Preview files are always .jpg
            const lastDot = filename.lastIndexOf('.');
            if (lastDot > 0) return filename.substring(0, lastDot) + '.jpg';
            return filename + '.jpg';
        }

        function getThumbUrl(item) {
            // Use preview branch for lightweight thumbnails
            const prevFn = previewFilename(item.filename);
            return `https://raw.githubusercontent.com/${REPO}/${PREVIEW_BRANCH}/previews/${encodeFilename(prevFn)}`;
        }

        function getDownloadUrl(item) {
            const encoded = encodeFilename(item.filename);
            const category = item.category || 'desktop';
            return `https://github.com/${REPO}/raw/${WALLPAPERS_BRANCH}/${category}/${encoded}`;
        }

        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function escapeAttr(str) {
            return str.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function isValidUrl(url) {
            try {
                const parsed = new URL(url);
                return parsed.protocol === 'http:' || parsed.protocol === 'https:';
            } catch (e) {
                return false;
            }
        }

        function renderGallery(items) {
            const gallery = document.getElementById('gallery');
            if (items.length === 0) {
                gallery.innerHTML = '<div class="empty">No wallpapers match your filters.</div>';
                return;
            }
            gallery.innerHTML = items.map(item => {
                const thumbUrl = getThumbUrl(item);
                const downloadUrl = getDownloadUrl(item);
                const safeName = escapeHtml(item.filename);
                const safeAlt = escapeAttr(item.filename);
                const safeServer = escapeHtml(serverNames[item.server] || item.server);
                const sizeText = item.size ? escapeHtml(item.size) : 'N/A';
                const resText = item.resolution ? escapeHtml(item.resolution) : '';
                const startTimeText = item.startTime_formatted ? escapeHtml(item.startTime_formatted) : '';
                const catLabel = item.category === 'mobile' ? 'üì± Mobile' : 'üñ•Ô∏è Desktop';
                const sourceLink = (item.imgUrl && isValidUrl(item.imgUrl))
                    ? `<a href="${escapeAttr(item.imgUrl)}" target="_blank" rel="noopener noreferrer">üîó Original</a>` : '';
                const cardClass = item.category === 'mobile' ? 'card card-portrait' : 'card';
                return `
                <div class="${cardClass}">
                    <a href="${escapeAttr(downloadUrl)}" target="_blank" rel="noopener noreferrer">
                        <img src="${escapeAttr(thumbUrl)}"
                             alt="${safeAlt}"
                             loading="lazy"
                             onerror="this.style.display='none'">
                    </a>
                    <div class="card-body">
                        <div class="card-filename">${safeName}</div>
                        <div style="margin-bottom:6px;font-size:12px;color:var(--text-muted)">
                            ${startTimeText ? `<span>üìÖ ${startTimeText}</span> ¬∑ ` : ''}<span>üì¶ ${sizeText}</span>${resText ? ` ¬∑ <span>üìê ${resText}</span>` : ''}
                        </div>
                        <div style="margin-bottom:8px;display:flex;flex-wrap:wrap;gap:4px">
                            <span class="badge" style="background:rgba(136,98,228,0.15);color:#a78bfa">
                                ${catLabel}
                            </span>
                            <span class="badge ${item.status === 'success' ? 'badge-success' : 'badge-danger'}">
                                ${item.status === 'success' ? '‚úÖ OK' : '‚ùå Failed'}
                            </span>
                            <span class="badge" style="background:rgba(88,166,255,0.15);color:var(--accent)">
                                ${safeServer}
                            </span>
                        </div>
                        <div class="card-actions">
                            ${item.status === 'success' ? `<a href="${escapeAttr(downloadUrl)}" class="download" target="_blank" rel="noopener noreferrer">‚¨á Download Raw</a>` : ''}
                            ${sourceLink}
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function parseSize(sizeStr) {
            if (!sizeStr) return 0;
            const match = sizeStr.match(/([0-9.]+)\s*(KB|MB|GB)?/i);
            if (!match) return 0;
            const num = parseFloat(match[1]);
            const unit = (match[2] || 'MB').toUpperCase();
            const multipliers = { KB: 1024, MB: 1024*1024, GB: 1024*1024*1024 };
            return num * (multipliers[unit] || 1);
        }

        function formatSize(bytes) {
            if (bytes === 0) return '0 B';
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
            return (bytes / (1024 * 1024 * 1024)).toFixed(2) + ' GB';
        }

        function updateStats(items) {
            const success = items.filter(i => i.status === 'success').length;
            const failed = items.filter(i => i.status === 'failed').length;
            const servers = new Set(items.map(i => i.server)).size;
            const totalBytes = items.reduce((sum, item) => sum + parseSize(item.size), 0);
            
            document.getElementById('statTotal').textContent = items.length;
            document.getElementById('statSuccess').textContent = success;
            document.getElementById('statFailed').textContent = failed;
            document.getElementById('statServers').textContent = servers;
            document.getElementById('statTotalSize').textContent = formatSize(totalBytes);
        }

        function getSelectedCheckboxes(containerSelector) {
            const container = document.querySelector(containerSelector);
            return Array.from(container.querySelectorAll('input[type="checkbox"]:checked'))
                .map(cb => cb.value);
        }

        function updateDropdownLabel(dropdownName, menuSelector, labelSelector) {
            const checkboxes = document.querySelectorAll(`${menuSelector} input[type="checkbox"]`);
            const checked = Array.from(checkboxes).filter(cb => cb.checked);
            const label = document.querySelector(labelSelector);
            
            if (checked.length === 0) {
                label.textContent = `No ${dropdownName}`;
            } else if (checked.length === checkboxes.length) {
                label.textContent = `All ${dropdownName}`;
            } else {
                label.textContent = `${checked.length} ${dropdownName}`;
            }
        }

        function setupDropdowns() {
            // Toggle dropdown on click
            document.querySelectorAll('.dropdown-toggle').forEach(toggle => {
                toggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const dropdown = toggle.getAttribute('data-dropdown');
                    const menu = toggle.nextElementSibling;
                    
                    // Close other dropdowns
                    document.querySelectorAll('.dropdown-menu').forEach(m => {
                        if (m !== menu) m.classList.remove('show');
                    });
                    document.querySelectorAll('.dropdown-toggle').forEach(t => {
                        if (t !== toggle) t.classList.remove('open');
                    });
                    
                    // Toggle current
                    menu.classList.toggle('show');
                    toggle.classList.toggle('open');
                });
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', () => {
                document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('show'));
                document.querySelectorAll('.dropdown-toggle').forEach(t => t.classList.remove('open'));
            });

            // Prevent dropdown from closing when clicking inside
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.addEventListener('click', (e) => e.stopPropagation());
            });
        }

        function sortItems(items, sortBy) {
            const [field, order] = sortBy.split('-');
            const sorted = [...items].sort((a, b) => {
                let valA = a[field] || '';
                let valB = b[field] || '';
                
                if (field === 'size') {
                    valA = parseSize(valA);
                    valB = parseSize(valB);
                }
                if (field === 'startTime') {
                    valA = a.startTime || 0;
                    valB = b.startTime || 0;
                }
                
                if (valA < valB) return order === 'asc' ? -1 : 1;
                if (valA > valB) return order === 'asc' ? 1 : -1;
                return 0;
            });
            return sorted;
        }

        function applyFilters() {
            const selectedServers = getSelectedCheckboxes('#serverFilterMenu');
            const selectedStatuses = getSelectedCheckboxes('#statusFilterMenu');
            const selectedCategories = getSelectedCheckboxes('#categoryFilterMenu');
            const selectedReleaseTimes = getSelectedCheckboxes('#releaseTimeFilterMenu');
            const search = document.getElementById('searchInput').value.toLowerCase();
            const sortBy = document.getElementById('sortFilter').value;

            // Update dropdown labels
            updateDropdownLabel('Servers', '#serverFilterMenu', '#serverFilterLabel');
            updateDropdownLabel('Categories', '#categoryFilterMenu', '#categoryFilterLabel');
            updateDropdownLabel('Status', '#statusFilterMenu', '#statusFilterLabel');
            updateDropdownLabel('Times', '#releaseTimeFilterMenu', '#releaseTimeFilterLabel');

            let filtered = allData;
            
            if (selectedServers.length > 0) {
                filtered = filtered.filter(i => selectedServers.includes(i.server));
            }
            if (selectedStatuses.length > 0) {
                filtered = filtered.filter(i => selectedStatuses.includes(i.status));
            }
            if (selectedCategories.length > 0) {
                filtered = filtered.filter(i => selectedCategories.includes(i.category));
            }
            if (selectedReleaseTimes.length > 0) {
                filtered = filtered.filter(i => selectedReleaseTimes.includes(i.releaseTime));
            }
            if (search) {
                filtered = filtered.filter(i => i.filename.toLowerCase().includes(search));
            }
            
            // Apply sorting
            filtered = sortItems(filtered, sortBy);

            // Update last updated timestamp based on filtered data
            const latestFilteredTime = filtered.reduce((latest, item) => {
                return item.releaseTime > latest ? item.releaseTime : latest;
            }, '');
            if (latestFilteredTime) {
                document.getElementById('lastUpdated').textContent = `Last Updated: ${latestFilteredTime}`;
            } else {
                document.getElementById('lastUpdated').textContent = 'Last Updated: N/A';
            }

            updateStats(filtered);
            renderGallery(filtered);
        }

        async function init() {
            try {
                await loadConfig();
                const manifest = await loadManifest();

                // Populate server names from manifest before building UI
                const serverIds = Object.keys(manifest).filter(k => k !== 'releaseTime');
                serverIds.forEach(id => {
                    const serverData = manifest[id];
                    if (serverData.name && !serverNames[id]) {
                        serverNames[id] = serverData.name;
                    }
                });

                // Populate server filter (checkboxes in dropdown)
                const serverFilterMenu = document.getElementById('serverFilterMenu');
                serverIds.forEach(id => {
                    const div = document.createElement('div');
                    div.className = 'checkbox-item';
                    const checkId = `server-${id}`;
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = checkId;
                    checkbox.value = id;
                    checkbox.checked = true;
                    const label = document.createElement('label');
                    label.htmlFor = checkId;
                    label.textContent = serverNames[id] || id;
                    div.appendChild(checkbox);
                    div.appendChild(label);
                    serverFilterMenu.appendChild(div);
                });

                // Build flat data array
                let latestTime = '';
                const releaseTime = manifest.releaseTime || '';
                serverIds.forEach(id => {
                    const serverData = manifest[id];
                    if (serverData.lastUpdated && serverData.lastUpdated > latestTime) {
                        latestTime = serverData.lastUpdated;
                    }
                    (serverData.wallpapers || []).forEach(w => {
                        allData.push({
                            server: id,
                            filename: w.filename,
                            imgUrl: w.imgUrl || w.url || '',
                            status: w.status || 'success',
                            releaseTime: w.releaseTime || releaseTime || serverData.lastUpdated || '',
                            startTime: w.startTime || 0,
                            startTime_formatted: w.startTime_formatted || '',
                            size: w.size || '',
                            resolution: w.resolution || '',
                            category: w.category || 'desktop'
                        });
                    });
                });

                if (latestTime) {
                    document.getElementById('lastUpdated').textContent = `Last Updated: ${latestTime}`;
                }

                // Populate release time filter (checkboxes in dropdown)
                const releaseTimeFilterMenu = document.getElementById('releaseTimeFilterMenu');
                const releaseTimes = [...new Set(allData.map(i => i.releaseTime).filter(Boolean))].sort().reverse();
                releaseTimes.forEach(rt => {
                    const div = document.createElement('div');
                    div.className = 'checkbox-item';
                    const checkId = `time-${rt.replace(/[^a-zA-Z0-9]/g, '-')}`;
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = checkId;
                    checkbox.value = rt;
                    checkbox.checked = true;
                    const label = document.createElement('label');
                    label.htmlFor = checkId;
                    label.textContent = rt;
                    div.appendChild(checkbox);
                    div.appendChild(label);
                    releaseTimeFilterMenu.appendChild(div);
                });

                // Setup dropdown functionality
                setupDropdowns();

                // Check URL params for pre-filter
                const params = new URLSearchParams(window.location.search);
                if (params.get('server')) {
                    const serverId = params.get('server');
                    // Uncheck all, then check only the requested server
                    serverFilterMenu.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                    const targetCb = document.getElementById(`server-${serverId}`);
                    if (targetCb) targetCb.checked = true;
                }

                // Attach event listeners
                document.querySelectorAll('#serverFilterMenu input[type="checkbox"]').forEach(cb => {
                    cb.addEventListener('change', applyFilters);
                });
                document.querySelectorAll('#statusFilterMenu input[type="checkbox"]').forEach(cb => {
                    cb.addEventListener('change', applyFilters);
                });
                document.querySelectorAll('#categoryFilterMenu input[type="checkbox"]').forEach(cb => {
                    cb.addEventListener('change', applyFilters);
                });
                document.querySelectorAll('#releaseTimeFilterMenu input[type="checkbox"]').forEach(cb => {
                    cb.addEventListener('change', applyFilters);
                });
                document.getElementById('sortFilter').addEventListener('change', applyFilters);
                document.getElementById('searchInput').addEventListener('input', applyFilters);

                applyFilters();
            } catch (e) {
                document.getElementById('gallery').innerHTML =
                    `<div class="empty">Failed to load data. The manifest may not exist yet in <code>data/manifest.json</code> on the main branch.</div>`;
            }
        }

        init();
    </script>
</body>
</html>
